# Story 1.2: Contract Form Enhancement — Novos Campos na UI

## Status: Approved

## Executor Assignment
- **executor:** @dev
- **quality_gate:** @architect
- **quality_gate_tools:** [npm run build, npm run lint]

## Story

**Como** gestor de mídia da Lojas Torra,
**quero** visualizar e editar todos os campos de um contrato (tipo de negociação, propriedades de mídia, documentos, layouts, orçamentos pendentes e comentários),
**para** ter controle completo das informações do contrato sem precisar consultar a planilha.

## Acceptance Criteria

- [ ] **AC-1:** Formulário de novo contrato (`/dashboard/contracts/new`) contém todos os campos do PRD FR-001
- [ ] **AC-2:** Formulário de edição (`/dashboard/contracts/[id]`) contém todos os campos e pré-preenche com dados existentes
- [ ] **AC-3:** Campo `media_properties` permite adicionar/remover múltiplas mídias (lista dinâmica ou input com tags)
- [ ] **AC-4:** Campos `contract_docs` e `layouts_url` são exibidos como links clicáveis quando preenchidos
- [ ] **AC-5:** Listagem de contratos exibe badge amarelo "Orçamento Pendente" quando `pending_quotes` está preenchido
- [ ] **AC-6:** Listagem exibe ícone de link para `layouts_url` quando preenchido
- [ ] **AC-7:** Formulários salvam e atualizam corretamente no Supabase incluindo os novos campos
- [ ] **AC-8:** `npm run build` e `npm run lint` passam sem erros

## Dev Notes

### Dependência
- **Bloqueante:** Story 1.1 deve estar completa (migration aplicada + types atualizados)

### Contexto Arquitetural
- PRD: `docs/prd/midiacore-prd.md` → FR-001
- Arquitetura: `docs/architecture/brownfield-architecture.md` → Seção 12.2

### Padrões de UI a Seguir
Baseado no código existente em `src/app/dashboard/contracts/new/page.tsx` e `[id]/page.tsx`:
- Classes de input: `pl-4 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:outline-none focus:ring-4 focus:ring-indigo-500/10`
- Labels: `text-[10px] font-black text-slate-400 uppercase tracking-widest`
- Cards de seção: `executive-card`
- Botão primário: `bg-indigo-600 text-white px-6 py-3 rounded-2xl font-black`

### Grupos de Campos no Formulário
Organizar em 5 seções:
1. **Dados do Ativo** → shopping_name, media_type, media_properties
2. **Financeiro & Status** → contract_value, status, pending_quotes
3. **Documentação** → contract_docs (URL), layouts_url (URL)
4. **Cronograma** → start_date, end_date, negotiation
5. **Stakeholder & Notas** → responsible_person, comments

### Input para `media_properties` (TEXT[])
- Usar um input de texto com botão "Adicionar"
- Exibir como tags/chips removíveis
- Ao salvar, converter array de strings para `text[]` do PostgreSQL

### Links Externos
- `contract_docs` e `layouts_url`: exibir como `<a href={url} target="_blank">` com ícone ExternalLink do Lucide

### Badge na Listagem
```tsx
{contract.pending_quotes && (
  <span className="px-2 py-1 bg-amber-50 text-amber-600 border border-amber-100 rounded-lg text-[10px] font-black uppercase">
    Orçamento Pendente
  </span>
)}
```

### Gotchas
- O cliente Supabase no browser é `createClient()` de `@/lib/supabase/client`
- Ao fazer UPDATE, incluir todos os novos campos para evitar sobrescrever com `undefined`
- `media_properties` deve ser salvo como array PostgreSQL: o SDK Supabase aceita `string[]` diretamente
- Campos opcionais vazios devem ser salvos como `null`, não string vazia

## Tasks

- [ ] **Task 1: Atualizar formulário de novo contrato**
  - [ ] 1.1 Abrir `src/app/dashboard/contracts/new/page.tsx`
  - [ ] 1.2 Adicionar campos: `negotiation`, `contract_docs`, `layouts_url`, `pending_quotes`, `comments`
  - [ ] 1.3 Implementar input dinâmico para `media_properties` (array)
  - [ ] 1.4 Atualizar payload do INSERT para incluir novos campos
  - [ ] 1.5 Organizar formulário nas 5 seções documentadas em Dev Notes

- [ ] **Task 2: Atualizar formulário de edição**
  - [ ] 2.1 Abrir `src/app/dashboard/contracts/[id]/page.tsx`
  - [ ] 2.2 Pré-preencher todos os novos campos ao carregar o contrato
  - [ ] 2.3 Exibir `contract_docs` e `layouts_url` como links clicáveis acima do input
  - [ ] 2.4 Atualizar payload do UPDATE para incluir novos campos

- [ ] **Task 3: Atualizar listagem de contratos**
  - [ ] 3.1 Abrir `src/app/dashboard/contracts/page.tsx`
  - [ ] 3.2 Adicionar badge "Orçamento Pendente" quando `pending_quotes` está preenchido
  - [ ] 3.3 Adicionar ícone de link externo para `layouts_url` quando preenchido
  - [ ] 3.4 Adicionar coluna "Negociação" na tabela (opcional, em tela larga)

- [ ] **Task 4: Verificação**
  - [ ] 4.1 Executar `npm run build` sem erros
  - [ ] 4.2 Executar `npm run lint` sem erros

## Dev Agent Record

### Agent Model Used: -
### Debug Log References: []
### Completion Notes: []

### File List
- `src/app/dashboard/contracts/new/page.tsx` — MODIFICADO
- `src/app/dashboard/contracts/[id]/page.tsx` — MODIFICADO
- `src/app/dashboard/contracts/page.tsx` — MODIFICADO

### Change Log
| Data | Alteração | Autor |
|------|-----------|-------|
| 2026-02-25 | Story criada | River (SM) |
| 2026-02-25 | Validação @po: GO (9/10) — adicionados executor/@dev, quality_gate/@architect | Pax (PO) |
