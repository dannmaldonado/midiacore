# Story 4.2: Tela de Prazos & Etapas de Aprovação

## Status: Draft

## Executor Assignment
- **executor:** @dev
- **quality_gate:** @qa
- **quality_gate_tools:** [npm run build, npm run lint, npm run typecheck]

## Story

**Como** gestor de mídia,
**quero** uma tela dedicada de "Prazos" no menu de navegação que exiba as 12 etapas do processo de aprovação com SLAs e a etapa vigente de cada contrato/job,
**para** que eu visualize o andamento real de cada negociação e identifique atrasos de forma imediata.

## Acceptance Criteria

- [ ] **AC-1:** Item "Prazos" adicionado no menu de navegação lateral (`/dashboard/prazos`)
- [ ] **AC-2:** Tela exibe as 12 etapas conforme planilha "PRAZOS / ETAPAS DE APROVAÇÃO":
  1. Solicitação da Proposta Audi × MKT Shopping — 1 dia
  2. Proposta MKT Shopping — 7 dias
  3. Análise Audi — 3 dias
  4. Aprovação MKT Torra — 15 dias
  5. Jurídico Torra — 30 dias
  6. Renovação sem Troca de Mídia — (sem SLA fixo)
  7. Renovação com Troca de Mídia — 15 dias
  8. Orçamento Produção c/ Retirada 1 Ano — 5 dias
  9. Produção e Instalação das Novas Mídias — 10 dias
  10. Checking de Instalação — (sem SLA fixo)
  11. Renovação Não Autorizada — (sem SLA fixo)
  12. Retirada das Mídias — 7 dias
- [ ] **AC-3:** Para cada contrato ativo, exibir badge com a etapa vigente
- [ ] **AC-4:** Etapa vigente destacada visualmente (borda colorida ou destaque bold)
- [ ] **AC-5:** Etapas com prazo vencido exibidas em vermelho
- [ ] **AC-6:** Link de cada contrato navega para `/dashboard/contracts/[id]/approvals`
- [ ] **AC-7:** Viewers veem a tela (read-only)
- [ ] **AC-8:** Build, lint e typecheck passam sem erros

## Dev Notes

### Etapas Hard-coded (baseado na planilha)
```ts
const PRAZOS_ETAPAS = [
  { id: 'proposta_solicitacao',  label: 'Solicitação da Proposta Audi × MKT Shopping', sla_days: 1  },
  { id: 'proposta_mkt',          label: 'Proposta MKT Shopping',                        sla_days: 7  },
  { id: 'analise_audi',          label: 'Análise Audi',                                 sla_days: 3  },
  { id: 'aprovacao_mkt_torra',   label: 'Aprovação MKT Torra',                          sla_days: 15 },
  { id: 'juridico_torra',        label: 'Jurídico Torra',                               sla_days: 30 },
  { id: 'renovacao_sem_troca',   label: 'Renovação sem Troca de Mídia',                 sla_days: null },
  { id: 'renovacao_com_troca',   label: 'Renovação com Troca de Mídia',                 sla_days: 15 },
  { id: 'orcamento_producao',    label: 'Orçamento Produção c/ Retirada 1 Ano',         sla_days: 5  },
  { id: 'producao_instalacao',   label: 'Produção e Instalação das Novas Mídias',       sla_days: 10 },
  { id: 'checking_instalacao',   label: 'Checking de Instalação',                       sla_days: null },
  { id: 'renovacao_nao_autorizada', label: 'Renovação Não Autorizada',                  sla_days: null },
  { id: 'retirada_midias',       label: 'Retirada das Mídias',                          sla_days: 7  },
]
```

### Layout
- Header: "Prazos & Etapas" com ícone Clock
- Coluna esquerda: lista das 12 etapas com SLA
- Coluna direita: contratos ativos agrupados por etapa vigente
- Ou tabela: linhas = contratos, colunas = etapas (timeline visual horizontal)

### Dados
- Buscar `contracts WHERE status = 'active'` com campo `current_step` (a ser adicionado via migração, Story 4.3)
- Até a Story 4.3 estar pronta, usar `approval_workflows.current_step` existente

## Tasks

- [ ] **Task 1:** Adicionar rota `/dashboard/prazos` e item no menu lateral
- [ ] **Task 2:** Criar `src/app/dashboard/prazos/page.tsx`
- [ ] **Task 3:** Criar componente `PrazosEtapas.tsx` com lista das 12 etapas
- [ ] **Task 4:** Buscar contratos ativos e mapear para etapa vigente
- [ ] **Task 5:** Implementar destaque visual da etapa vigente + alerta de prazo vencido
- [ ] **Task 6:** Run build, lint, typecheck

## File List
- `src/app/dashboard/prazos/page.tsx` — NEW
- `src/components/dashboard/PrazosEtapas.tsx` — NEW
- `src/components/dashboard/Sidebar.tsx` — MODIFIED (adicionar item "Prazos")

## Dev Agent Record

### Agent Model Used: —
### Status: Draft

### Change Log:
- 2026-02-27: Story criada por @architect (Aria) com base nas solicitações do cliente

---

## QA Results

### Reviewed By: —
### Gate Decision: PENDING
